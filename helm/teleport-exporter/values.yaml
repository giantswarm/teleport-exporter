replicas: 1

registry:
  domain: gsoci.azurecr.io

image:
  name: "giantswarm/teleport-exporter"
  # tag: "" # Defaults to Chart.Version

imagePullSecrets: []

global:
  podSecurityStandards:
    enforced: true

pod:
  user:
    id: 65532
  group:
    id: 65532

nodeSelector: {}
tolerations: []

# Additional custom pod labels
podLabels: {}

# Pod securityContext
podSecurityContext:
  runAsNonRoot: true
  seccompProfile:
    type: RuntimeDefault

# Container securityContext
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  privileged: false
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  seccompProfile:
    type: RuntimeDefault

resources:
  requests:
    cpu: 50m
    memory: 64Mi
  limits:
    cpu: 100m
    memory: 128Mi

# Teleport connection settings
teleport:
  # Address of the Teleport proxy or auth server (required)
  # Example: teleport.example.com:443
  address: ""

  # Path to the identity file inside the container
  # This should be mounted from a secret or volume
  identityFilePath: "/var/run/teleport/identity"

  # Skip TLS certificate verification (not recommended for production)
  insecure: false

  # Create Teleport CRD resources (Role, Bot, ProvisionToken)
  # Enable this when deploying in the Teleport cluster with CRDs installed
  createResources: false

# Exporter settings
exporter:
  # How often to refresh metrics from Teleport API
  refreshInterval: 30s

# Identity file secret configuration
# The identity file should be generated using tbot or tctl
identity:
  # Name of an existing secret containing the identity file
  # The secret should have a key named "identity" containing the identity file content
  # If tbot.enabled is true and this is empty, it defaults to <release-name>-identity
  existingSecret: ""

# tbot configuration for automatic identity management
# When enabled, tbot runs as a separate deployment and manages the identity secret
tbot:
  # Enable tbot deployment for automatic identity renewal
  enabled: false

  # Name of the secret where tbot will store the identity
  # Defaults to <release-name>-identity
  identitySecretName: ""

  # How often tbot renews the certificate
  renewalInterval: "20m"

  # Certificate TTL
  certificateTTL: "24h"

  image:
    registry: gsoci.azurecr.io
    name: giantswarm/tbot-distroless
    # Use same major version as Teleport server for compatibility
    tag: "18.2.4"
    pullPolicy: IfNotPresent

  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 250m
      memory: 256Mi

monitoring:
  serviceMonitor:
    enabled: true
    labels: {}
    interval: ""
    scrapeTimeout: ""
    relabelings:
      - action: labeldrop
        regex: pod|service|container
    metricRelabelings: []

  # Grafana dashboard ConfigMap for automatic provisioning
  grafanaDashboard:
    enabled: true
    # Namespace where the ConfigMap will be created (typically where Grafana is deployed)
    namespace: monitoring
    # Additional labels for the ConfigMap
    labels: {}
    # Additional annotations for the ConfigMap
    annotations: {}

networkpolicy:
  enabled: true

podAnnotations: {}

verticalPodAutoscaler:
  enabled: false
  containerPolicies:
    minAllowed:
      cpu: 25m
      memory: 32Mi
    maxAllowed:
      cpu: 500m
      memory: 512Mi
